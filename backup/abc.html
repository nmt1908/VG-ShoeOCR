<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>ROI Cropper - Enhanced</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #dbeafe;
            --success: #22c55e;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray: #64748b;
            --border-radius: 16px;
            --transition: all 0.3s ease;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 6px 24px rgba(0, 0, 0, 0.12);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            color: var(--dark);
            min-height: 100vh;
            padding: 30px;
            overflow-x: hidden;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 0 20px;
        }
        
        .header h1 {
            font-size: 2.8rem;
            color: var(--primary);
            margin-bottom: 12px;
            font-weight: 800;
            letter-spacing: -0.5px;
        }
        
        .header p {
            font-size: 1.2rem;
            color: var(--gray);
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 1fr 1.8fr 1fr;
            gap: 28px;
            max-width: 1920px;
            margin: 0 auto;
        }
        
        .panel {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 28px;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            height: 100%;
        }
        
        .panel:hover {
            box-shadow: var(--shadow-hover);
        }
        
        .panel-title {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 22px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary-light);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .panel-title i {
            background: var(--primary-light);
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }
        
        #drop-area {
            border: 2.5px dashed var(--primary);
            background: var(--primary-light);
            padding: 36px 20px;
            text-align: center;
            margin-bottom: 26px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
        }
        
        #drop-area:hover {
            background: #d0e1ff;
            border-color: #1d4ed8;
        }
        
        #drop-area p {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 20px;
        }
        
        #drop-area button {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 14px 30px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0 auto;
        }
        
        #drop-area button:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
        }
        
        #img-size {
            font-size: 1rem;
            color: var(--gray);
            margin-bottom: 20px;
            text-align: center;
            padding: 12px;
            background: #f1f5f9;
            border-radius: 10px;
        }
        
        #canvas-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #f1f5f9;
            border-radius: var(--border-radius);
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            padding: 16px;
            flex-grow: 1;
            min-height: 500px;
        }
        
        #roi-canvas {
            border: 2px solid var(--primary);
            border-radius: var(--border-radius);
            cursor: crosshair;
            background: white;
            max-width: 100%;
            max-height: 100%;
            display: block;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            object-fit: contain;
        }
        
        #roi-toast {
            display: none;
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success);
            color: white;
            padding: 12px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.25);
            z-index: 10;
        }
        
        #capture-btn {
            background: var(--success);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 18px 0;
            font-size: 1.3rem;
            cursor: pointer;
            box-shadow: 0 4px 14px rgba(34, 197, 94, 0.2);
            transition: var(--transition);
            font-weight: 600;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        #capture-btn:hover {
            background: #16a34a;
            transform: translateY(-2px);
        }
        
        #capture-btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            transform: none;
        }
        
        #result {
            border: 2px solid #e2e8f0;
            border-radius: var(--border-radius);
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background: white;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.04);
            padding: 20px;
            min-height: 300px;
            margin-bottom: 25px;
        }
        
        #result img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .instruction-box {
            background: #f1f5f9;
            border-radius: var(--border-radius);
            padding: 22px;
            width: 100%;
        }
        
        .instruction-box h3 {
            font-size: 1.2rem;
            color: var(--primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .instruction-box ul {
            margin: 0;
            padding-left: 24px;
        }
        
        .instruction-box li {
            margin-bottom: 12px;
            line-height: 1.6;
        }
        
        .instruction-box kbd {
            display: inline-block;
            padding: 3px 8px;
            background: var(--dark);
            color: white;
            border-radius: 6px;
            font-size: 0.9rem;
            font-family: monospace;
            margin: 0 4px;
        }
        
        #ocrResultsContainer {
            width: 100%;
            margin-top: 0;
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 8px;
        }
        
        .ocr-title {
            text-align: center;
            font-weight: 700;
            font-size: 1.4rem;
            color: var(--primary);
            margin: 0 0 22px 0;
        }
        
        .ocr-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 12px;
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
        }
        
        .ocr-table th,
        .ocr-table td {
            font-size: 1.1rem;
            padding: 14px 16px;
            text-align: left;
        }
        
        .ocr-table th {
            background: var(--primary-light);
            font-weight: 600;
            color: var(--primary);
            position: sticky;
            top: 0;
        }
        
        .ocr-table th.fixed-header {
            background: #ffebee;
            color: var(--danger);
        }
        
        .ocr-table tr {
            transition: var(--transition);
        }
        
        .ocr-table tr:hover {
            background-color: #f8fafc;
        }
        
        .ocr-table td {
            background: #f8fafc;
            border-radius: 10px;
        }
        
        .ocr-table td input {
            width: 100%;
            font-size: 1.1rem;
            padding: 10px 14px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            background: white;
            color: var(--dark);
            transition: var(--transition);
        }
        
        .ocr-table td input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
        }
        
        .ocr-table td input.fixed {
            border: 2px solid var(--danger);
            background: #fff5f5;
            color: var(--danger);
            font-weight: 600;
        }
        
        .stt-cell {
            background: var(--primary-light) !important;
            color: var(--primary);
            font-weight: 700;
            border-radius: 10px 0 0 10px !important;
            width: 60px;
            text-align: center;
        }
        
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-top: 24px;
        }
        
        .dict-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 16px 0;
            font-size: 1.2rem;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .dict-btn:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
        }
        
        #dict-status {
            margin-top: 10px;
            font-size: 1.1rem;
            color: var(--primary);
            text-align: center;
            padding: 12px;
            background: #f1f5f9;
            border-radius: 10px;
            font-weight: 500;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            padding: 12px;
            border-radius: 10px;
            font-weight: 500;
        }
        
        .status-ready {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-warning {
            background: #fef9c3;
            color: #854d0e;
        }
        
        .status-error {
            background: #fee2e2;
            color: #b91c1c;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            color: var(--gray);
            font-size: 1rem;
            padding: 20px;
        }
        
        /* Responsive design */
        @media (max-width: 1600px) {
            .app-container {
                gap: 20px;
            }
            
            .panel {
                padding: 22px;
            }
        }
        
        @media (max-width: 1280px) {
            .app-container {
                grid-template-columns: 1fr;
                max-width: 900px;
            }
            
            .panel-title {
                font-size: 1.4rem;
            }
            
            #canvas-container {
                min-height: 500px;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 20px 15px;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            #drop-area {
                padding: 25px 15px;
            }
            
            #drop-area p {
                font-size: 1.1rem;
            }
            
            .panel {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-crop-alt"></i> ROI Image Cropper</h1>
        <p>Công cụ cắt ảnh thông minh với chức năng nhận dạng văn bản (OCR) và chỉnh sửa vùng quan tâm (ROI)</p>
    </div>
    
    <div class="app-container">
        <!-- Left Panel - Image Input & ROI -->
        <div class="panel">
            <div class="panel-title">
                <i class="fas fa-1"></i>
                <span>Ảnh & Vùng quan tâm (ROI)</span>
            </div>
            
            <div id="drop-area">
                <p><i class="fas fa-cloud-upload-alt"></i> Kéo và thả ảnh vào đây</p>
                <input type="file" id="fileElem" accept="image/*" style="display:none">
                <button onclick="document.getElementById('fileElem').click()">
                    <i class="fas fa-folder-open"></i> Chọn ảnh
                </button>
            </div>
            
            <div id="img-size"></div>
            
            <div id="canvas-container">
                <canvas id="roi-canvas" width="600" height="800"></canvas>
                <div id="roi-toast">Đã lưu cấu hình ROI!</div>
            </div>
            
            <button id="capture-btn" disabled>
                <i class="fas fa-camera"></i> Chụp ảnh
            </button>
        </div>
        
        <!-- Center Panel - Results & Instructions -->
        <div class="panel">
            <div class="panel-title">
                <i class="fas fa-2"></i>
                <span>Kết quả cắt ảnh & Hướng dẫn</span>
            </div>
            
            <div id="result">
                <div class="placeholder">
                    <i class="fas fa-image" style="font-size: 4rem; color: #cbd5e1; margin-bottom: 15px;"></i>
                    <p style="color: #94a3b8; font-size: 1.2rem;">Kết quả cắt ảnh sẽ hiển thị tại đây</p>
                </div>
            </div>
            
            <div class="instruction-box">
                <h3><i class="fas fa-info-circle"></i> Hướng dẫn sử dụng</h3>
                <ul>
                    <li>Kéo thả hoặc chọn ảnh để bắt đầu quá trình xử lý</li>
                    <li>Nhấn phím <kbd>E</kbd> 3 lần để bật chế độ chỉnh sửa ROI</li>
                    <li>Nhấn phím <kbd>S</kbd> 3 lần để lưu ROI và tắt chế độ chỉnh sửa</li>
                    <li>Kéo thả vùng ROI trên ảnh, sau đó bấm <b>Chụp ảnh</b> để xem kết quả</li>
                    <li>Sử dụng các góc để điều chỉnh kích thước vùng ROI</li>
                </ul>
            </div>
            
            <div class="status-indicator status-warning">
                <i class="fas fa-exclamation-circle"></i>
                <span>Chưa có ảnh để xử lý. Vui lòng chọn hoặc kéo thả ảnh vào khu vực bên trái.</span>
            </div>
        </div>
        
        <!-- Right Panel - OCR Results -->
        <div class="panel">
            <div class="panel-title">
                <i class="fas fa-3"></i>
                <span>Kết quả nhận dạng (OCR)</span>
            </div>
            
            <div id="ocrResultsContainer">
                <div class="placeholder" style="text-align: center; padding: 40px 20px; color: #94a3b8;">
                    <i class="fas fa-font" style="font-size: 4rem; margin-bottom: 20px;"></i>
                    <h3 style="font-size: 1.4rem; margin-bottom: 15px;">Chưa có dữ liệu OCR</h3>
                    <p>Kết quả nhận dạng văn bản sẽ hiển thị tại đây sau khi bạn chụp ảnh</p>
                </div>
            </div>
            
            <div class="action-buttons">
                <button id="fetch-dict-btn" class="dict-btn">
                    <i class="fas fa-sync-alt"></i> Tải từ điển OCR
                </button>
                <div id="dict-status">Từ điển chưa được tải</div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>ROI Image Cropper &copy; 2023 | Công cụ xử lý ảnh chuyên nghiệp</p>
    </div>
    
    <script>
        // DOM Elements
        const dropArea = document.getElementById('drop-area');
        const fileElem = document.getElementById('fileElem');
        const canvas = document.getElementById('roi-canvas');
        const ctx = canvas.getContext('2d');
        const captureBtn = document.getElementById('capture-btn');
        const resultDiv = document.getElementById('result');
        const imgSizeDiv = document.getElementById('img-size');
        const ocrResultsContainer = document.getElementById('ocrResultsContainer');
        const roiToast = document.getElementById('roi-toast');
        const statusIndicator = document.querySelector('.status-indicator');
        
        // State variables
        let img = null;
        let imgNaturalWidth = 0, imgNaturalHeight = 0;
        let scale = 1;
        let roi = { x: 150, y: 150, w: 300, h: 180 };
        let dragging = false, resizing = false, dragOffset = {}, resizeCorner = null;
        let sCount = 0, eCount = 0;
        let roiEditable = false;
        let uploadedFilename = null;
        let uploadedFileHex = null;
        let dictionary = [];
        
        // Initialize
        function init() {
            draw();
            setupEventListeners();
            updateStatus('Vui lòng chọn ảnh để bắt đầu', 'warning');
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // File drop and selection
            dropArea.addEventListener('dragover', handleDragOver);
            dropArea.addEventListener('dragleave', handleDragLeave);
            dropArea.addEventListener('drop', handleDrop);
            fileElem.addEventListener('change', handleFileSelect);
            
            // Canvas interactions
            canvas.addEventListener('mousedown', handleCanvasMouseDown);
            canvas.addEventListener('mousemove', handleCanvasMouseMove);
            canvas.addEventListener('mouseup', handleCanvasMouseUp);
            canvas.addEventListener('mouseleave', handleCanvasMouseLeave);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyDown);
            
            // Buttons
            captureBtn.addEventListener('click', handleCapture);
            document.getElementById('fetch-dict-btn').addEventListener('click', fetchDictionary);
        }
        
        // Update status indicator
        function updateStatus(message, type = 'warning') {
            statusIndicator.className = 'status-indicator';
            statusIndicator.classList.add(`status-${type}`);
            
            let icon = 'fa-info-circle';
            if (type === 'error') icon = 'fa-exclamation-circle';
            if (type === 'ready') icon = 'fa-check-circle';
            
            statusIndicator.innerHTML = `
                <i class="fas ${icon}"></i>
                <span>${message}</span>
            `;
        }
        
        // Draw image and ROI
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (img) {
                // Draw image
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                
                // Draw ROI rectangle
                ctx.save();
                ctx.strokeStyle = '#ef4444';
                ctx.lineWidth = 2.5;
                ctx.setLineDash([8]);
                ctx.strokeRect(roi.x, roi.y, roi.w, roi.h);
                ctx.setLineDash([]);
                
                // Draw resize handles
                const handles = getHandles();
                handles.forEach(h => {
                    ctx.fillStyle = '#2563eb';
                    ctx.fillRect(h.x - 7, h.y - 7, 14, 14);
                    ctx.strokeStyle = '#fff';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(h.x - 7, h.y - 7, 14, 14);
                });
                ctx.restore();
            } else {
                // Draw placeholder
                ctx.fillStyle = '#f1f5f9';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = '#cbd5e1';
                ctx.font = '20px "Segoe UI", sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Kéo thả ảnh vào khung bên trái', canvas.width/2, canvas.height/2 - 20);
                
                ctx.font = '16px "Segoe UI", sans-serif';
                ctx.fillText('hoặc nhấn nút "Chọn ảnh"', canvas.width/2, canvas.height/2 + 20);
            }
        }
        
        // Get 4 corners for resizing
        function getHandles() {
            return [
                { x: roi.x, y: roi.y }, // top-left
                { x: roi.x + roi.w, y: roi.y }, // top-right
                { x: roi.x, y: roi.y + roi.h }, // bottom-left
                { x: roi.x + roi.w, y: roi.y + roi.h } // bottom-right
            ];
        }
        
        // Handle file operations
        function handleDragOver(e) {
            e.preventDefault();
            dropArea.style.background = '#d0e1ff';
        }
        
        function handleDragLeave(e) {
            e.preventDefault();
            dropArea.style.background = '';
        }
        
        function handleDrop(e) {
            e.preventDefault();
            dropArea.style.background = '';
            handleFiles(e.dataTransfer.files);
        }
        
        function handleFileSelect(e) {
            handleFiles(e.target.files);
        }
        
        function handleFiles(files) {
            if (!files.length) return;
            const file = files[0];
            
            // Simulate upload process
            updateStatus('Đang xử lý ảnh...', 'ready');
            
            // Create preview image
            img = new Image();
            img.onload = function() {
                imgNaturalWidth = img.naturalWidth;
                imgNaturalHeight = img.naturalHeight;
                imgSizeDiv.textContent = `Kích thước ảnh: ${imgNaturalWidth} × ${imgNaturalHeight} pixels`;
                
                // Calculate scale to fit canvas
                const maxScaleWidth = canvas.clientWidth - 40;
                const maxScaleHeight = canvas.clientHeight - 40;
                scale = Math.min(
                    maxScaleWidth / imgNaturalWidth, 
                    maxScaleHeight / imgNaturalHeight,
                    1
                );
                
                canvas.width = Math.round(imgNaturalWidth * scale);
                canvas.height = Math.round(imgNaturalHeight * scale);
                
                // Reset ROI position to center
                roi = {
                    x: (canvas.width - 300) / 2,
                    y: (canvas.height - 180) / 2,
                    w: 300,
                    h: 180
                };
                
                draw();
                captureBtn.disabled = false;
                updateStatus('Ảnh đã sẵn sàng. Bạn có thể điều chỉnh vùng ROI', 'ready');
            };
            
            img.src = URL.createObjectURL(file);
            uploadedFilename = file.name;
        }
        
        // Canvas interaction handlers
        function handleCanvasMouseDown(e) {
            if (!img || !roiEditable) return;
            
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const x = (e.clientX - rect.left) * scaleX;
            const y = (e.clientY - rect.top) * scaleY;
            
            const handleIdx = getHandleAt(x, y);
            if (handleIdx !== -1) {
                resizing = true;
                resizeCorner = handleIdx;
            } else if (x > roi.x && x < roi.x + roi.w && y > roi.y && y < roi.y + roi.h) {
                dragging = true;
                dragOffset = { x: x - roi.x, y: y - roi.y };
            }
        }
        
        function handleCanvasMouseMove(e) {
            if (!img || !roiEditable || (!dragging && !resizing)) return;
            
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const x = (e.clientX - rect.left) * scaleX;
            const y = (e.clientY - rect.top) * scaleY;
            
            if (resizing) {
                resizeROI(x, y);
            } else if (dragging) {
                dragROI(x, y);
            }
            
            draw();
        }
        
        function resizeROI(x, y) {
            switch (resizeCorner) {
                case 0: // top-left
                    roi.w += roi.x - x;
                    roi.h += roi.y - y;
                    roi.x = x;
                    roi.y = y;
                    break;
                case 1: // top-right
                    roi.w = x - roi.x;
                    roi.h += roi.y - y;
                    roi.y = y;
                    break;
                case 2: // bottom-left
                    roi.w += roi.x - x;
                    roi.x = x;
                    roi.h = y - roi.y;
                    break;
                case 3: // bottom-right
                    roi.w = x - roi.x;
                    roi.h = y - roi.y;
                    break;
            }
            
            // Constrain dimensions
            roi.w = Math.max(50, Math.min(roi.w, canvas.width - roi.x));
            roi.h = Math.max(50, Math.min(roi.h, canvas.height - roi.y));
            roi.x = Math.max(0, Math.min(roi.x, canvas.width - 50));
            roi.y = Math.max(0, Math.min(roi.y, canvas.height - 50));
        }
        
        function dragROI(x, y) {
            roi.x = Math.max(0, Math.min(x - dragOffset.x, canvas.width - roi.w));
            roi.y = Math.max(0, Math.min(y - dragOffset.y, canvas.height - roi.h));
        }
        
        function handleCanvasMouseUp() {
            dragging = false;
            resizing = false;
            resizeCorner = null;
        }
        
        function handleCanvasMouseLeave() {
            dragging = false;
            resizing = false;
            resizeCorner = null;
        }
        
        function getHandleAt(x, y) {
            const handles = getHandles();
            for (let i = 0; i < handles.length; i++) {
                const h = handles[i];
                if (Math.abs(h.x - x) < 14 && Math.abs(h.y - y) < 14) {
                    return i;
                }
            }
            return -1;
        }
        
        // Keyboard shortcuts
        function handleKeyDown(e) {
            if (e.key === 'e' || e.key === 'E') {
                eCount++;
                if (eCount === 3) {
                    eCount = 0;
                    roiEditable = true;
                    showToast('Chế độ chỉnh ROI: BẬT');
                }
                sCount = 0;
            } else if (e.key === 's' || e.key === 'S') {
                sCount++;
                if (sCount === 3) {
                    sCount = 0;
                    roiEditable = false;
                    showToast('Chế độ chỉnh ROI: TẮT & Đã lưu cấu hình ROI!');
                }
                eCount = 0;
            } else {
                sCount = 0;
                eCount = 0;
            }
        }
        
        function showToast(message) {
            roiToast.textContent = message;
            roiToast.style.display = 'block';
            setTimeout(() => {
                roiToast.style.display = 'none';
            }, 3000);
        }
        
        // Capture button handler
        function handleCapture() {
            if (!img) {
                updateStatus('Chưa có ảnh để cắt!', 'error');
                return;
            }
            
            // Simulate processing
            updateStatus('Đang cắt ảnh và nhận dạng văn bản...', 'ready');
            
            // Create cropped image
            const croppedCanvas = document.createElement('canvas');
            croppedCanvas.width = roi.w;
            croppedCanvas.height = roi.h;
            
            const croppedCtx = croppedCanvas.getContext('2d');
            croppedCtx.drawImage(
                canvas,
                roi.x, roi.y, roi.w, roi.h,
                0, 0, roi.w, roi.h
            );
            
            // Display result
            const dataUrl = croppedCanvas.toDataURL('image/png');
            resultDiv.innerHTML = `<img src="${dataUrl}" alt="Cropped Result">`;
            
            // Simulate OCR results
            simulateOCRResults();
        }
        
        // Simulate OCR results (for demo)
        function simulateOCRResults() {
            const sampleData = {
                line1: "123456-VA",
                line2: "MS253842-1",
                line3: "MS7WS8.5 C1",
                line4: "CCF 11/28/2024",
                line5: "M/W-RIP024",
                line6: "MS7WS8.5"
            };
            
            const fixedData = {
                line1: "123456-VA",
                line2: "MS253842-1",
                line3: "MS7WS8.5 C1",
                line4: "CCF 11/28/2024",
                line5: "M/W-RIP024",
                line6: "MS7WS8.5"
            };
            
            renderOCRResults(sampleData, fixedData);
        }
        
        // Render OCR results
        function renderOCRResults(original, fixed) {
            const lines = [
                { label: "Dòng 1", original: original.line1, fixed: fixed.line1 },
                { label: "Dòng 2", original: original.line2, fixed: fixed.line2 },
                { label: "Dòng 3", original: original.line3, fixed: fixed.line3 },
                { label: "Dòng 4", original: original.line4, fixed: fixed.line4 },
                { label: "Dòng 5", original: original.line5, fixed: fixed.line5 },
                { label: "Dòng 6", original: original.line6, fixed: fixed.line6 }
            ];
            
            let html = `
                <div class="ocr-title">
                    <i class="fas fa-font"></i> Kết quả nhận dạng văn bản
                </div>
                <table class="ocr-table">
                    <thead>
                        <tr>
                            <th>Dòng</th>
                            <th>Kết quả gốc</th>
                            <th class="fixed-header">Kết quả đã sửa</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            lines.forEach((line, index) => {
                const isDifferent = line.original !== line.fixed;
                html += `
                    <tr>
                        <td class="stt-cell">${line.label}</td>
                        <td>
                            <input type="text" value="${line.original}" readonly>
                        </td>
                        <td>
                            <input type="text" value="${line.fixed}" readonly 
                                   class="${isDifferent ? 'fixed' : ''}">
                        </td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
                <div class="status-indicator status-ready" style="margin-top: 20px;">
                    <i class="fas fa-check-circle"></i>
                    <span>Hoàn thành nhận dạng văn bản với độ chính xác cao</span>
                </div>
            `;
            
            ocrResultsContainer.innerHTML = html;
        }
        
        // Fetch dictionary
        function fetchDictionary() {
            const statusDiv = document.getElementById('dict-status');
            statusDiv.textContent = 'Đang tải từ điển...';
            
            // Simulate API call
            setTimeout(() => {
                dictionary = [
                    "MS253842-1", "MS7WS8.5", "M/W-RIP024", 
                    "123456-VA", "11/28/2024", "CCF", "C1"
                ];
                
                statusDiv.innerHTML = `
                    <span style="color: #166534;">
                        <i class="fas fa-check-circle"></i> 
                        Đã tải ${dictionary.length} mục từ điển
                    </span>
                `;
            }, 1500);
        }
        
        // Initialize application
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>